{% load wagtailcore_tags wagtailimages_tags navbar %}

{% with menu=settings.navbar.NavbarSettings.menu  %}

<ul role="menu" id="mobileMenu" style="max-height: 90vh" class="overflow-auto hidden lg:hidden bg-white pb-4 border-b-2 shadow-md border-green-500 z-50">
  {% for item in menu %}
    {% if item.block_type == "internal_page" %}
      <li>
        <a role="menuitem" class="block pl-8 py-3 {% if self.url|startswith:item.value.page.url %}font-bold text-green-500{% endif %}"
          href="{% pageurl item.value.page %}">{{ item.value.title|default:item.value.page.title }}</a>
      </li>
    {% else %}
      <li>
        <button type="button" role="menuitem" aria-expanded="false" aria-haspopup="true"
                class="js-toggle-mobile-menu w-full pl-8 pr-4 py-3 flex items-center">
          {{ item.value.title }}
          <svg class="ml-4 h-4 w-4 fill-current" viewBox="0 0 20 20"><path d="M9.293 12.95l.707.707L15.657 8l-1.414-1.414L10 10.828 5.757 6.586 4.343 8z" /></svg>
        </button>

        <ul role="menu" class="hidden ml-8 pl-4 border-l-2 border-green-400">
          {% for item in item.value.submenu %}
            {% for item in item.value.submenu %}
              <li class="block mb-2 max-w-xs">
                <a role="menuitem" href="{% pageurl item.value.page %}"
                  class="p-1 -ml-1 inline-block text-gray-800 hover:text-gray-900
                    {% if item.value.page.url == self.url %}font-bold text-green-500{% endif %}">
                  <div class="text-sm">{{ item.value.title|default:item.value.page.title }}</div>
                </a>
              </li>
            {% endfor %}
          {% endfor %}

        </ul>
      </li>
    {% endif %}
  {% endfor %}
</ul>

{% endwith %}


<script>
// toggle mobile megamenu
document.querySelectorAll('.js-toggle-mobile-menu').forEach(function (button) {
  var menu = button.parentElement.querySelector('[role="menu"]')

  function toggle() {
    menu.classList.toggle('hidden')
    button.classList.toggle('bg-green-400')
    button.setAttribute('aria-expanded', menu.classList.contains('hidden') ? 'false' : 'true')
  }
  
  // toggle on click
  button.addEventListener('click', function (event) {
    toggle()
  })

})
</script>