{% extends "core/__base.html" %}
{% load wagtailcore_tags %}
{% load static from staticfiles %}


{% block body_class %}template-search{% endblock %}

{% block title_suffix %}Suche{% endblock %}
{% block meta %}{% endblock %}

{% block content %}
  <div class="pageheader">
    <div class="container">
      <form class="big-search" action="{% url 'search' %}" method="get">
        <input id="searchinput"
               class="big-search__input js-search-focus js-swap-placeholder"
               data-placeholder-small="Suche" autofocus type="search"
               placeholder="Was interessiert dich?" autocomplete="off"
               name="q"{% if query_string %} value="{{ query_string }}"{% endif %}
               onfocus="this.value = this.value;">
      </form>
    </div>
  </div>


  <div class="center-container">
    <div id="spinner" class="hide">
      <div class="big-font blinking-dots">Laden<span>.</span><span>.</span><span>.</span></div>
      <div class="pagination"></div>
      <div class="card-grid margin-top-1">
        {% for i in "123" %}
          <div class="bigcard">
            <div class="bigcard__inner">
              <div class="bigcard__image-placeholder"></div>
            </div>
          </div>
        {% endfor %}
      </div>
    </div>

    <div id="searchresults">
      {% include "search/_search_results.html" %}
    </div>
  </div>
{% endblock %}

{% block js %}
  {{ block.super }}
  <script>
    $( document ).ready( function() {
      function resetTimer(timer) {
        if (timer) clearTimeout(timer);
      }
      function ajaxCall() {
        if ($(this).val() != previousValue) {
          resetTimer(this.timer);
          this.timer = setTimeout(function() {
            var q = $('#searchinput').val();
            $('#searchresults').html('&nbsp;').load('{% url "search" %}?q=' + q );
          }, 300);
          previousValue = $(this).val();
        }
      }
      var previousValue = "{{ query_string }}";
      $('#searchinput').on('keyup click input', ajaxCall);
      $('#searchinput').keydown(function (e) {
        if (e.which == 13) {
          event.preventDefault();
          ajaxCall();
        }
      });
    });

    $(document).ajaxStart( function() {
      $('#spinner').removeClass('hide');
    }).ajaxStop( function() {
      $('#spinner').addClass('hide');
    });
  </script>
{% endblock %}
