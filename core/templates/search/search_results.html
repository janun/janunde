{% extends "core/__base.html" %}
{% load wagtailcore_tags wagtailimages_tags %}
{% load static from staticfiles %}
{% load stuff %}


{% block title_suffix %}Suche{% endblock %}
{% block meta %}{% endblock %}

{% block content %}

<main class="max-w-5xl mx-auto px-4 mt-10 md:mt-16">

  {% comment %} form {% endcomment %}
  <form method="GET" class="flex" action="{% url 'search' %}">
    <div class="relative max-w-md w-full">
      <input type="text" name="q" value="{{ search_query }}"
          class="pr-8 border focus:border-gray-500 outline-none focus:shadow rounded-md px-4 py-2 w-full"
          autofocus autocomplete="off" placeholder="Suchbegriff">
      <div class="absolute right-0 inset-y-0 flex items-center border-l">
        <button type="submit" class="h-full px-4 text-green-500 hover:text-green-600">
          <svg class="transition-all duration-100 fill-current w-4 h-4" viewBox="0 0 20 20"><path d="M12.9 14.32a8 8 0 1 1 1.41-1.41l5.35 5.33-1.42 1.42-5.33-5.34zM8 14A6 6 0 1 0 8 2a6 6 0 0 0 0 12z"/></svg>
        </button>
      </div>
    </div>
  </form>

  {% comment %} results {% endcomment %}
  <div class="my-8 mb-12 md:my-12">
    {% if search_results %}
      <div class="text-sm">{{ search_results.paginator.count }} Ergebnisse gefunden</div>
    {% endif %}

    {% for res in search_results %}
      {% with result=res.specific %}
        <a href="{% pageurl result %}" class="group flex -ml-4 md:ml-0 my-10">
          <div class="mr-3 flex-shrink-0">
            {% image result.get_image fill-256x256 as result_image %}
            <img {{ result_image.attrs }} loading="lazy" class="w-16 h-16 md:w-20 md:h-20 object-cover border">
          </div>
          <div>
            <div class="text-xs font-light">
              {{ result.get_url|unquote_url }}
            </div>
            <h3 class="md:text-lg font-bold group-hover:underline mb-1">{{ result.title }}</h3>
            <div class="font-light text-sm">{{ result.get_description }}</div>
            <div class="font-light text-sm text-gray-600">{{ result.last_published_at|date:"d.m.Y" }}</div>
          </div>
        </a>
      {% endwith %}
    {% empty %}
      {% if search_query %}
        Keine Ergebnisse gefunden.
      {% else %}
        Schreib deinen Suchbegriff in das Suchfeld.
      {% endif %}
    {% endfor %}

    {% comment %} pagination {% endcomment %}
  {% if search_results.paginator.num_pages > 1 %}
    <div class="flex justify-start">
      <ul class="flex -mx-2 my-10">
        {% if search_results.has_previous %}
          <li>
            <a class="p-1 px-3 rounded text-gray-700"
              href="?q={{ search_query }}&page={{ search_results.previous_page_number }}">
              <span>←</span>
            </a>
          </li>
        {% endif %}

        {% for page_num in search_results.paginator.page_range %}
          <li>
            <a class="mx-1 p-1 px-3 rounded {% if page_num == search_results.number %}bg-green-500 text-white font-bold{% else %}border text-gray-700{% endif %}"
              href="?q={{ search_query }}&page={{ page_num }}">
              {{ page_num }}
            </a>
          </li>
        {% endfor %}

        {% if search_results.has_next %}
          <li>
            <a class="p-1 px-3 rounded text-gray-700"
              href="?q={{ search_query }}&page={{ search_results.next_page_number }}">
              <span>→</span>
            </a>
          </li>
        {% endif %}
      </ul>
    </div>
  {% endif %}
  </div>

</main>
{% endblock %}
