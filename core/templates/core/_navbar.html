{% load wagtailcore_tags menu wagtailimages_tags %}
{% load static from staticfiles %}


{% get_site_root as site_root %}
{% if site_root %}
  {% get_menuitems parent=site_root calling_page=self as menuitems %}
{% endif %}

<div class="navbar fixed top-0 h-16 lg:h-18 text-base w-full shadow-md bg-white z-50 shadow">
  <nav class="flex items-center max-w-screen-lg xl:max-w-screen-xl mx-auto px-4 h-full" role="navigation" aria-label="HauptmenÃ¼">

    <a class="group flex items-center mr-5 h-full" title="Zur Startseite" href="/">
      <svg class="fill-current text-green-500 group-hover:text-green-700 h-7 xl:h-10" viewbox="0 0 108 37"><path d="M17.791.01c-.537.062-.889.436-.889 1.136-.1 1.3 1.202 3.302 2.702 4.202l.199.1c1.3 2.9 5.6 11.5 6.1 15-.6.2-1.1.6-1.6 1l-.801.798c-3.3-.1-11.5-4.198-13.6-4.898v-.301c0-1.4-1.9-3-4.5-3.7-3-.7-5.5.1-5.4 1.8.1 1.8 2.802 3.4 5.602 3.8 1.5.2 2.7 0 3.5-.5 1.8 1.1 10.6 4.7 12.6 7.3-.2 1.2.099 2.2.599 3 .2.9-3.3 3.5-4.2 4.3l-.8.1c-1.2.3-2.2 1.2-2.2 2s1 1.1 2.1.7c1-.4 1.9-1.2 1.9-1.9l-.101-.4c.7-.5 2.901-2.8 4.701-3.5a5 5 0 006.4-1.3c2.8-3.9-.701-7.1-3.101-4.7-3.1 3.1.3 4.6 1.8 3l.2-.2.201-.6c.1-.6-.3-1-.8-1s-1 .5-1.1 1.1c-.1.1 0 .3 0 .4-.5-.1-.8-.5-.5-1.1 1.5-3.4 5.5-.9 2.8 2.6-2.6 3.3-11.3.8-4.4-5.9 2.5-2.4 6.1-1.3 7.1 1.1 1.1 2.6-.9 6.1-3.4 8 1-.7 2.999-2.3 3.599-3.6l1.701 1v.1c0 .3.1.6.4.5.2-.1.4-.4.5-.8.1-.4-.1-.7-.3-.6l-.1-.1-.201.1-1.7-1.3c.3-1 .4-2.1.2-3.1.3-.8 2.7-2.5 3.4-3.1l.202.1c.3.1.5-.2.6-.7.1-.4-.002-.9-.302-1-.2-.1-.5.2-.6.7v.3l-3.698 2.4c-.2-.4-.5-.8-.9-1.1.1-3.1 1.498-6.9 1.798-8 .3 0 .502-.3.602-.8.1-.6-.202-1.4-.602-1.8-.5-.4-.9-.1-1 .6l.102.8c-.3 1.3-1.302 6.3-2.602 8.2-.5-.1-1-.3-1.6-.3-1.9-2.2-6.1-14.5-6.4-14.6h-.1l.202-.6c.1-1.2-.901-2.9-2.301-4-.75-.55-1.474-.8-2.012-.737zm31.4 9.002L46.676 23.83c-.401 1.338-1.123 1.951-2.432 1.951-.08 0-.16-.027-.24-.027l-.373 2.258c2.511-.223 6.038-1.422 6.332-3.178l2.676-15.822H49.19zm12.561 2.967a9.073 9.073 0 00-.87.001s-2.269.084-5.689 1.004l-1.816 10.762h3.525l.725-4.324c.137-.122.374-.288.877-.342.592-.063 1.645-.276 2.31-.416.25-.053.458-.151.588-.219l-.892 5.301h3.392l1.362-8.03c.467-2.78-1.48-3.64-3.512-3.737zm13.771 0a9.073 9.073 0 00-.869.001s-2.27.084-5.69 1.004l-1.818 10.762h3.528l1.523-9.09c.882-.194 1.656-.334 2.004-.334.748 0 1.602.335 1.469 1.172l-1.39 8.252h3.394l1.361-8.03c.468-2.78-1.479-3.64-3.512-3.737zm27.98 0a9.073 9.073 0 00-.868.001s-2.272.084-5.692 1.004l-1.816 10.762h3.527l1.522-9.09c.882-.194 1.656-.334 2.004-.334.748 0 1.601.335 1.468 1.172l-1.388 8.252h3.392l1.364-8.03c.468-2.78-1.48-3.64-3.512-3.737zm-20.735.62c-.562 3.374-1.416 8.392-1.416 8.42-.374 2.314.668 3.29 3.1 3.4 2.413.085 7.074-1.197 7.421-3.204l1.441-8.615h-3.392l-1.123 6.775c-.323 1.923-1.102 2.76-2.66 2.76-.78 0-1.42-.363-1.26-1.256l1.394-8.28h-3.505zM60.43 14.323c.747 0 1.602.335 1.468 1.172l-.064.387c-.115.079-.304.189-.674.28-.586.143-1.74.341-2.476.462a2.096 2.096 0 00-.621.205l.363-2.172c.881-.194 1.656-.334 2.004-.334z"/></svg>
    </a>

    <div class="flex items-center w-full h-full">
      {% comment %} menu items {% endcomment %}
      <div class="hidden md:flex xl:ml-8 h-full">
        {% if menuitems %}
          {% for menuitem in menuitems %}
            <a class="group flex px-2 xl:mx-1 text-gray-700 hover:text-gray-900 {% if menuitem.is_active %}text-gray-900 hover:text-gray-900{%endif%}" href="{% pageurl menuitem %}">
              <div class="flex items-center border-b-4 pt-1 border-transparent {% if menuitem.is_active %}border-green-500{% endif %}">
                {{ menuitem.title }}
              </div>
            </a>
          {% endfor %}
        {% endif %}
      </div>

      {% comment %} search form {% endcomment %}
      <form class="hidden md:flex ml-auto relative items-center" action="{% url 'search' %}" method="GET">
        <div class="inline-flex items-center relative w-full text-gray-500 focus-within:text-green-500 hover:text-gray-700">
          <input autocomplete="off" type="text" name="q" class="pt-px border outline-none border-current text-current focus:text-gray-700 rounded-full pl-10 bg-white h-10 w-32 xl:w-40 transition-all duration-100 focus:w-64 focus:border-green-500 placeholder-current" placeholder="Suche">
          <div class="absolute left-0 inset-y-0 flex items-center">
            <svg class="transition-all duration-100 fill-current w-4 h-4 ml-4" viewBox="0 0 20 20"><path d="M12.9 14.32a8 8 0 1 1 1.41-1.41l5.35 5.33-1.42 1.42-5.33-5.34zM8 14A6 6 0 1 0 8 2a6 6 0 0 0 0 12z"/></svg>
          </div>
        </div>
      </form>

      {% comment %} social media (desktop only) {% endcomment %}
      {% if settings.core.SocialMediaSettings.social_medias.all %}
        <div class="hidden md:flex items-center justify-center lg:justify-start ml-4 xl:ml-12">
          {% for social_media in settings.core.SocialMediaSettings.social_medias.all|slice:3 %}
            {% image social_media.icon_color original as icon %}
            <a class="mx-2 md:transition-transform md:duration-200 md:transform md:hover:scale-125" href="{{ social_media.link }}" target="_blank" title="{{ social_media.tooltip }}">
              <img class="w-7" loading="lazy" src="{{ icon.url }}">
            </a>
          {% endfor %}
        </div>
      {% endif %}

      <button id="menuButton" class="ml-auto md:hidden px-2 h-full outline-none">
        <svg id="menuButtonOpen" class="h-4 w-4 fill-current" viewBox="0 0 32 32"><path d="M.84 6.05C.6 5.8.46 5.47.46 5.08s.13-.72.38-.98.58-.38.98-.38h28.5c.4 0 .73.12 1 .38s.37.58.37.98-.14.7-.4.97-.57.38-.97.38H1.83c-.4 0-.73-.12-1-.38zm30.47 8.9c.26.27.4.6.4 1s-.14.7-.4.96-.57.4-.97.4H1.83c-.4 0-.73-.13-1-.4s-.37-.57-.37-.96.13-.72.38-.98.58-.38.98-.38h28.5c.4 0 .73.13 1 .38zm0 10.87c.26.25.4.58.4.97s-.14.7-.4.97-.57.38-.97.38H1.83c-.4 0-.73-.12-1-.38s-.37-.58-.37-.98.13-.73.38-.98.58-.38.98-.38h28.5c.4 0 .73.13 1 .38z" fill="#644327"/></svg>
        <svg id="menuButtonClose" class="hidden h-4 w-4 fill-current" viewBox="0 0 20 20"><path d="M10 8.586L2.929 1.515 1.515 2.929 8.586 10l-7.071 7.071 1.414 1.414L10 11.414l7.071 7.071 1.414-1.414L11.414 10l7.071-7.071-1.414-1.414L10 8.586z"/></svg>
      </button>

    </div>

  </nav>

  {% comment %} mobile menu items {% endcomment %}
  <div id="mobileMenu" class="hidden md:hidden bg-white py-4 border-b-2 shadow-md border-green-500">
    {% for menuitem in menuitems %}
      <a class="block pl-12 py-3 {% if menuitem.is_active %}font-bold text-green-500{%endif%}" href="{% pageurl menuitem %}">{{ menuitem.title }}</a>
    {% endfor %}
    <div class="my-3 pt-5">
      <a class="flex items-center pl-12 pt-4" href="{% url 'search' %}">
        <svg class="fill-current w-3 h-3 mr-2" viewBox="0 0 20 20"><path d="M12.9 14.32a8 8 0 1 1 1.41-1.41l5.35 5.33-1.42 1.42-5.33-5.34zM8 14A6 6 0 1 0 8 2a6 6 0 0 0 0 12z"/></svg>
        Suche
      </a>
    </div>
  </div>
</div>

<script>
  document.addEventListener('click', function (event) {
    if (event.target === mobileMenu || mobileMenu.contains(event.target) || event.target === menuButton || menuButton.contains(event.target)) {
      return
    }
    if (!mobileMenu.classList.contains('hidden')) {
      event.preventDefault()
      mobileMenu.classList.add('hidden')
      document.querySelector('.navbar').classList.remove('menuOpen')
      menuButtonOpen.classList.remove('hidden')
      menuButtonClose.classList.add('hidden')
    }
  })

  menuButton.addEventListener('click', function () {
    mobileMenu.classList.toggle('hidden')
    document.querySelector('.navbar').classList.toggle('menuOpen')
    menuButtonOpen.classList.toggle('hidden')
    menuButtonClose.classList.toggle('hidden')
  })
</script>
