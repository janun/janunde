{% extends "core/__base.html" %}
{% load wagtailcore_tags wagtailimages_tags nettes_datum %}
{% load static from staticfiles %}
{% load render_partial %}

{% block content %}
  <div class="max-w-7xl mx-auto px-4">

    <div class="my-8 md:my-16">
      <h1 class="text-green-500 text-2xl md:text-3xl font-bold">{{ self.heading }}</h1>
    </div>
    
    {% regroup events by month as events_by_month %}
      
    <div class="flex items-start justify-between">
      <aside class="hidden md:block sticky mr-4" style="top: 80px">
        <ul class="flex mb-8 -mx-2">
          <li class="mx-2">
            <a class="py-2 border-b-2 {% if past %}border-transparent{% else %}text-green-600 border-green-400{% endif %}" href="{% pageurl self %}">Kommende</a>
          </li>
          <li class="mx-2">
            <a class="py-2 border-b-2 {% if past %}text-green-600 border-green-400{% else %}border-transparent{% endif %}" href="{% pageurl self %}?past=1&year={% now "Y" %}">Vergangene</a>
          </li>
        </ul>

        <ul>
          {% for events in events_by_month %}
            <li class="mb-2"><a href="#{{ events.grouper|date:"Y-m" }}">{{ events.grouper|format_month }}
                <span class="text-gray-600 text-sm">({{ events.list|length }})</span>
              </a>
            </li>
          {% endfor %}
        </ul>
      </aside>

      <main class="w-full max-w-3xl">
        {% for events in events_by_month %}
          <div class="mb-20">
            <h2 id="{{ events.grouper|date:"Y-m" }}" class="text-gray-600 text-base mb-5 mt-0">{{ events.grouper|format_month }}</h2>
              {% for event in events.list %}

                <div class="relative mb-8 md:mb-12 h-32 md:h-36 -mx-4 sm:mx-0">
                  <a class="block flex bg-white shadow-md hover:shadow-lg text-gray-700 sm:rounded-lg h-32 md:h-36" href="{% pageurl event %}">
                    {% image event.main_image max-600x400 class="object-cover sm:rounded-bl-lg sm:rounded-tl-lg w-32 md:w-56 border-r" %}
                    <div class="p-3 md:p-5">
                      <div class="text-xs md:text-sm mb-3">
                        <time title="{{ event.start }}">{{ event.start|date:"D d.m." }}</time>
                        <span class="" title="{{ event.location }}">in {{ event.location|truncatechars:30 }}</span>
                      </div>

                      <h3 class="text-brown text-xl mb-1 font-semibold">{{ event.title }}</h3>
                      {% if event.subtitle %}
                        <div class="text-xs md:text-sm">{{ event.subtitle }}</div>
                      {% endif %}
                    </div>

                  </a>
                  {% if event.related_group %}
                    <a href="{% pageurl event.related_group %}" title="{{ event.related_group.title }}"
                       class="absolute w-12 h-12 top-0 right-0 -mt-2 md:-mt-5 sm:-mr-2 md:-mr-4 sm:w-20 sm:h-20 overflow-hidden shadow-md hover:shadow-lg p-2 sm:p-3 bg-white flex items-center justify-center rounded-full"
                       >
                      {% image event.related_group.logo max-400x400 class="w-full h-full object-contain" %}
                    </a>
                  {% endif %}
                </div>

              {% endfor %}
            </div>
        {% endfor %}
      </main>
    </div>

  </div>
{% endblock %}
